<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>调用摄像头</title>
</head>

<body>
<main>
  <div id="controls"></div>
  <video id="video" autoplay muted playsinline></video><br>
</main>
</body>
<script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
<script>
  const vConsole = new window.VConsole();
  // 根据id获取video元素
  const video = document.getElementById('video');
  // 定义一个变量，用来存储视频流
  let currentStream;

  // 此方法是获取到可用的设备数量（包括可用的摄像头数量）
  function gotDevices(mediaDevices) {
    // mediaDevices是获取到的可用设备数量（包括音频设备和摄像头设备）
    console.log(mediaDevices, '-----')
    if (mediaDevices) {
      console.log('访问用户媒体设备失败：');
      return false;
    }
    mediaDevices.forEach(mediaDevice => {
      // if判断是为了将摄像头设备遍历出来，使用videoinput判断（videoinput是摄像头设备）
      if (mediaDevice.kind === 'videoinput' && mediaDevice.deviceId === 'environment') {
        console.dir(mediaDevice, '====')
        // 清除所有的视频流
        if (typeof currentStream !== 'undefined') {
          currentStream.getTracks().forEach(track => {
            track.stop();
          });
        }
        const videoConstraints = {};
        videoConstraints.deviceId = { exact: mediaDevice.deviceId };
        const constraints = {
          video: videoConstraints,
          audio: false
        };
        navigator.mediaDevices.getUserMedia(constraints).then(stream => {
          currentStream = stream;
          video.srcObject = stream;
          return navigator.mediaDevices.enumerateDevices();
        }).then(gotDevices).catch(error => {
          console.error(error);
        });
      }
    });
  }
  navigator.mediaDevices.enumerateDevices().then(gotDevices);
</script>

</html>